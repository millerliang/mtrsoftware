<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Hejun Dandi Manager Page</title>
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
	<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
	<style>
		thead th:last-child,tbody td:last-child{text-align:center;white-space:nowrap;}
		.img-responsive{max-width:128px;}
	</style>
</head>

<body>
	<!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top__" role="navigation">
		<div class="container">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="#">Hejun Dandi Manager</a>
			</div>
			<div id="navbar" class="navbar-collapse collapse">
				<ul class="nav navbar-nav">
					<li class="active"><a href="#">Text</a></li>
					<li><a href="#about">Text</a></li>
					<li><a href="#contact">Text</a></li>
					<li class="dropdown">
						<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Dropdown <span class="caret"></span></a>
						<ul class="dropdown-menu" role="menu">
							<li><a href="#">Text</a></li>
							<li><a href="#">Text</a></li>
							<li><a href="#">Text</a></li>
							<li class="divider"></li>
							<li class="dropdown-header">Nav header</li>
							<li><a href="#">Text</a></li>
							<li><a href="#">Text</a></li>
						</ul>
					</li>
				</ul>
			</div><!--/.nav-collapse -->
		</div>
    </nav>

	<main id="app" class="container">
		<div class="row">
			<article class="col-sm-9">
				<h2>和君点滴 items list</h2>
				<p class="text-muted"><i class="fa fa-book"></i> for web Database.</p>
				<table class="table table-striped">
					<thead>
						<tr>
							<th>Pict</th>
							<th>Title</th>
							<th>tag</th>
							<th>Url Link</th>
							<th>Tools</th>
						</tr>
					</thead>
					<tbody>
						<tr v-for="book in books" :key="book['.key']">
							<td><img class="img-responsive" v-bind:src="book.img" alt=" image"></td>
							<td>{{book.title}}</td>
							<td>{{book.subName}}</td>
							<td><a v-bind:href="book.url" target="_blank">{{book.url}}</a></td>
							<td>
								<button class="btn btn-link" @click="editBook(book)"><i class="fa fa-edit text-muted"></i> Edit</button>
								<button class="btn btn-link" @click="removeBook(book)"><i class="fa fa-trash-o text-danger"></i></button>
							</td>
						</tr>
					</tbody>
				</table>
			</article>
			<aside class="col-sm-3 _col-sm-offset-1">
				<h3>Form tools</h3>
				<form id="form" class="form-group" ____v-on:submit.prevent="addBook">
					<label for="bookImg" class="text-muted">图片连结</label>
					<input id="bookImg" class="form-control" type="text" v-model="newBook.img" placeholder="img url link"><br>
					<label for="bookTitle" class="text-muted">标题名称</label>
					<input id="bookTitle" class="form-control" type="text" v-model="newBook.title" placeholder="Title"><br>
					<label for="bookAuthor" class="text-muted">Tag Name</label>
					<input id="bookAuthor" class="form-control" type="text" v-model="newBook.subName" placeholder="Tag"><br>
					<label for="bookUrl" class="text-muted">网页连结</label>
					<input id="bookUrl" class="form-control" type="text" v-model="newBook.url" placeholder="Url"><br>
					<footer>
						<button type="button" class="btn btn-primary" v-if="!newBook['.key']" @click="addBook">New item</button>
						<button type="button" class="btn btn-success" v-if="newBook['.key']" @click="updateBook(newBook)">Update</button>
						<button type="button" class="btn btn-default" v-if="newBook['.key']" @click="CancelBtn">Cancel &times;</button>
					</footer>
				</form>
			</aside>
		</div>
	</main>

	<!-- Bootstrap core JavaScript
    ================================================== -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<!-- Vue2.js link -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.4.2/vue.js"></script>
	<!-- Google Firebase config -->
	<script src="https://www.gstatic.com/firebasejs/4.1.5/firebase.js"></script>
	<!-- VueFire -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vuefire/1.4.3/vuefire.min.js"></script>
	<!-- toastr.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
	<link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" rel="stylesheet">

	<script>
	// Initialize Firebase
	var config = {
		databaseURL: "https://hejun-29013.firebaseio.com"
	};
	firebase.initializeApp(config);
	
	var db = firebase.database();
	var bookRef = db.ref('dandiitems');

	var app = new Vue({
		el: '#app',
		data: {
			newBook: {
				img: '',
				title: '',
				subName: '',
				url: ''
			}
		},
		firebase: {
			books: bookRef
		},
		methods: {
			addBook: function(){
				bookRef.push(this.newBook);
				this.newBook.img = "";
				this.newBook.title = "";
				this.newBook.subName = "";
				this.newBook.url = "";
				toastr.info('Add new Book.')
			},
			editBook: function(book){
				this.newBook = book;
				toastr.warning('Edit this Book')
			},
			removeBook: function(book){
				bookRef.child(book['.key']).remove();
				toastr.error('Remove this item')
			},
			updateBook: function(book) {
				var childKey = book['.key'];
				//this.$firebaseRefs.books.child(childKey).set(book)
				delete book['.key'];
				bookRef.child(childKey).set(book)
				location.reload();
				//toastr.info('Uppdate this Book.')
			},
			CancelBtn: function(book) {
				location.reload();
				//delete book['.key'];
			}
		}
	})
	</script>
</body>
</html>