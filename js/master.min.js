$(document).ready(function () {
// NAV Menu Star
	var menus = [
	{
		"id": "1",
		"name": "公司簡介",
		"url": "#",
		"parent":"0"
	},
	{
		"id": "2",
		"name": "產品介紹",
		"url": "#",
		"parent":"1"
	},
	{
		"id": "3",
		"name": "檔案下載",
		"url": "#",
		"parent":"1"
	},
	{
		"id": "4",
		"name": "診所版本更新",
		"url": "#",
		"parent":"3"
	},
	{
		"id": "5",
		"name": "藥局版本更新",
		"url": "#",
		"parent":"3"
	},
	{
		"id": "6",
		"name": "健保相關",
		"url": "#",
		"parent":"3"
	},
	{
		"id": "7",
		"name": "蒙利特相關",
		"url": "#",
		"parent":"3"
	},
	{
		"id": "8",
		"name": "驅動程式",
		"url": "#",
		"parent":"3"
	},
	{
		"id": "9",
		"name": "應用程式",
		"url": "#",
		"parent":"3"
	},
	{
		"id": "10",
		"name": "健保網站",
		"url": "#",
		"parent":"1"
	},
	{
		"id": "11",
		"name": "聯繫我們",
		"url": "#",
		"parent":"1"
	}
];

function buildMenu(menus){
	var rootMenu = [];
	var childMenu = [];
	var rootIndex = 0;
	var childIndex = 0;
	for(i=0; i<menus.length; i++){
		var menu = menus[i];
		if(menu.parent == "0"){
			rootMenu[rootIndex] = menu;
			rootIndex++;
		}else{
			childMenu[childIndex] = menu;
			childIndex++;
		}
	}
	var generated = "<ul id='menu' class='nav navbar-nav'>";
	for(var i=0; i<rootMenu.length; i++){
		var parentMenu = rootMenu[i];
		var generatedMenu = buildChildMenu(parentMenu, childMenu, generated);
		generated = generatedMenu;
	}
	return generated;
};

function buildChildMenu(parentMenu, childMenu, generatedMenu){
	var parentId = parentMenu.id;
	if(parentMenu.parent == "0"){
		generatedMenu = generatedMenu + "<li><a href='"+parentMenu.url+"'>"+parentMenu.name+"</a>";
	}else{
		generatedMenu = generatedMenu + "<ul class='dropdown-menu' role'menu'>";
	}
	for(var j=0; j<childMenu.length; j++){
		var child = childMenu[j];
		if(parentId == child.parent){
			if(isHaveChild(child.id, childMenu)){
				generatedMenu = generatedMenu+"<li role='presentation' class='dropdown'><a class'dropdown-toggle' data-toggle='dropdown' href='#'>"+child.name+"<span class='caret'></span></a>";
				generatedMenu = buildChildMenu(child, childMenu, generatedMenu)+"</li>";
			}else{
				generatedMenu = generatedMenu+"<li><a href='"+child.url+"'>"+child.name+"</a></li>";
			}
		}
	}
	if(parentMenu.parent == "0"){
		generatedMenu = generatedMenu + "</li>";
	}else{
		generatedMenu = generatedMenu + "</ul>";
	}
	return generatedMenu;
};

function isHaveChild(parentId, childMenu){
	for(var k=0; k<childMenu.length; k++){
		if(childMenu[k].parent == parentId) return true;
	}
	return false;
};

var menu = buildMenu(menus);
$('#bs-example-navbar-collapse-1').html(menu);
// NAV Menu End

// Footer Star
var footer_text =[{
			name:"Mtrsoftware, Inc.",
			phone:"02-2304-7767~8",
			fax:"02-2337-8834",
			loc:"台北市中正區泉州街18之1號 6 樓",
			mail:"service@msa.hinet.net",
			url:"mtrsoftware.com.tw",
			subject:"蒙利特您好，有事請您幫忙!"
            }];
$.each(footer_text,function(index,obj)
{
	footer_items = "<address>";
	footer_items += "<strong>" + obj.name + "</strong><br>";
	footer_items += "<i class='fa fa-phone'></i> 電話：" + obj.phone + "<br>";
	footer_items += "<i class='fa fa-fax'></i> 傳真：" + obj.fax + "<br>";
	footer_items += "<i class='fa fa-building-o'></i> " + obj.loc +"</address>";
	footer_items += "<p><i class='fa fa-envelope-o'></i> <a href='mailto:" + obj.mail + "?subject=" + obj.subject + "'>" + obj.mail + "</a><br>";
	footer_items += "<i class='fa fa-globe'></i> <a href='" + obj.url + "'>" + obj.url + "</a></p>";
	$('#compny_info').append(footer_items);
	
});
// Footer End

	var param = {};
	var obj = {};
	obj.status = '成功';

	param.jsonData = JSON.stringify(obj);

	$.ajax({
		//url: "hotNews.json",
		url: "https://millerliang.github.io/MTRsoftware/hotNews.json",
		type: "GET",
		data: param
	})
	.success(function (data) {
		$.each(data.news_items, function (index, d) {
			news_lists = "<tr>";
			news_lists += "<td>" + d.date + "</td>";
			news_lists += "<td class='" + d.color + "'>" + d.type + "</td>";
			news_lists += "<td><a class='" + d.icon + "' href='" + d.url + "' target='_blank'>" + d.cont + "</a></td>";
			news_lists += "</tr>";
			$('#hotNews tbody').append(news_lists);
		});
		$.each(data.verson_items, function (index, d) {
			news_lists += "<td>" + d.date + "</td>";
			news_lists += "<td class='" + d.color + "'>" + d.type + "</td>";
			news_lists += "<td><a class='" + d.icon + "' href='" + d.url + "' target='_blank'>" + d.cont + "</a></td>";

			news_lists = "<tr>";
			news_lists += "<td>" + d.pot_date + "</td>";
			news_lists += "<td>VER " + d.verson + " 版";
			news_lists += "<ol>" + d.cont + "</ol></td>";
			news_lists += "<td>Ver " + d.verson + "</td>";
			news_lists += "<td class='text-center'>";
			news_lists += "<p>MtrVer" + d.verson + "</p>";
			news_lists += "<a href='" + d.url + "'><img src='http://mtrsoftware.com.tw/images/download.gif'></a>";
			news_lists += "<div>更新日期<br>" + d.up_date + "</div";
			news_lists += "</td>";
			news_lists += "</tr>";
			$('#verson_dl tbody').append(news_lists);
		});
	})
	.done(function () {
		$("#loading").hide();
	})
	.error(function (data) {
		alert("ERROR:  " + data);
	});

});

// .jSlider Scroll to top
// browser window scroll (in pixels) after which the "back to top" link is shown
var offset = 150,
//browser window scroll (in pixels) after which the "back to top" link opacity is reduced
offset_opacity = 1200,
//duration of the top scrolling animation (in ms)
scroll_top_duration = 700,
//grab the "back to top" link
$back_to_top = $('.jSlider');

//hide or show the "back to top" link
$(window).scroll(function(){
	( $(this).scrollTop() > offset ) ? $back_to_top.addClass('cd-is-visible') : $back_to_top.removeClass('cd-is-visible cd-fade-out');
	if( $(this).scrollTop() > offset_opacity ) { 
		$back_to_top.addClass('cd-fade-out');
	}
});

// Smooth scroll to top
$back_to_top.on('click', function(event){
	event.preventDefault();
	$('body,html').animate({
		scrollTop: 0 ,
		}, scroll_top_duration
	);
});